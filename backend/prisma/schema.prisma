// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Service Model - Represents a payable service
model Service {
  id                String   @id @default(cuid())
  name              String
  description       String?
  cost              Decimal   @db.Decimal(18, 6) // Cost in USDC (6 decimals)
  frequency         String   // monthly, weekly, yearly
  recipientAddress  String   // Service provider wallet address
  isActive          Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  subscriptions     Subscription[]

  @@map("services")
}

// Subscription Model - User's subscription to a service
model Subscription {
  id                String   @id @default(cuid())
  serviceId         String
  userAddress       String   // User's wallet address
  cost              Decimal   @db.Decimal(18, 6) // Cost in USDC (can override service cost)
  frequency         String   // monthly, weekly, yearly
  recipientAddress  String   // Service provider wallet address
  lastPaymentDate   DateTime?
  nextPaymentDate   DateTime
  isActive          Boolean  @default(true)
  autoPay           Boolean  @default(false)
  usageData         Json?    // { lastUsed, usageCount, avgUsagePerMonth }
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  service           Service   @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  payments          Payment[]

  @@map("subscriptions")
}

// Payment Model - Records of payments made for subscriptions
model Payment {
  id                String   @id @default(cuid())
  subscriptionId   String
  amount            Decimal   @db.Decimal(18, 6) // Amount paid in USDC
  transactionHash  String   @unique
  network           String   @default("cronos-testnet") // Network where payment was made
  status            String   @default("completed") // completed, failed, pending
  errorMessage      String?
  timestamp         DateTime @default(now())

  // Relations
  subscription      Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@map("payments")
}
